<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The AI Dilemma - Poll</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .animate-spin {
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div id="app"></div>

    <script>
        // ====== AIRTABLE CONFIGURATION ======
        // REPLACE THESE WITH YOUR ACTUAL VALUES
        const AIRTABLE_TOKEN = "patXCd6EZKaL6hPNs"; // Your Personal Access Token
        const AIRTABLE_BASE_ID = "appvnZktJSa8NsnhG"; // Your Base ID
        const AIRTABLE_TABLE_NAME = "Responses"; // Your Table Name
        // ====================================

        const dilemmas = [
            {
                id: 1,
                title: "Students use ChatGPT to generate ideas for class discussion",
                question: "Should I restrict AI use during class preparation?",
                guideline: "Lesson Enactment: Avoid over-reliance. Design parts of the lesson where students engage in non-AI critical thinking, discussion, or hands-on work.",
                emoji: "üí≠"
            },
            {
                id: 2,
                title: "I receive a piece of work that seems AI-generated, but I'm not certain",
                question: "Should I confront the student directly about it?",
                guideline: "Assessment and Feedback: State clearly if AI is permitted in formative work, and the conditions (e.g. must acknowledge tool used, context of use).",
                emoji: "ü§î"
            },
            {
                id: 3,
                title: "Students use ChatGPT to generate step-by-step solutions for tutorial questions",
                question: "Should I allow students to use AI-generated solutions as part of their learning process?",
                guideline: "Positive Classroom Culture: Address misconceptions. Clarify that AI is a tool, not a replacement for human effort or creativity.",
                emoji: "üìù"
            },
            {
                id: 4,
                title: "A teacher uses AI to draft Prelim/Promo exam questions",
                question: "Should teachers rely on AI tools to generate assessment questions?",
                guideline: "Lesson Preparation: Select vetted, MOE-approved or school-endorsed AI tools (e.g. SLS); avoid entering sensitive student or staff data into public tools (e.g. ChatGPT, Gemini).",
                emoji: "‚úçÔ∏è"
            }
        ];

        let currentPage = 'home';
        let selectedDilemma = null;
        let userVote = null;
        let comment = '';
        let isSubmitting = false;
        let submitSuccess = false;
        let votes = {
            1: { yes: 0, no: 0 },
            2: { yes: 0, no: 0 },
            3: { yes: 0, no: 0 },
            4: { yes: 0, no: 0 }
        };
        let votedDilemmas = new Set();

        function render() {
            const app = document.getElementById('app');
            
            if (currentPage === 'home') {
                app.innerHTML = renderHomePage();
            } else if (currentPage === 'poll') {
                app.innerHTML = renderPollPage();
            } else if (currentPage === 'results') {
                app.innerHTML = renderResultsPage();
            }
        }

        function renderHomePage() {
            return `
                <div class="max-w-4xl mx-auto p-6">
                    <div class="text-center mb-12">
                        <h1 class="text-5xl font-bold text-indigo-900 mb-4">ü§ñ The AI Dilemma</h1>
                        <p class="text-xl text-indigo-700">Let us know your thoughts!</p>
                        <p class="text-gray-600 mt-2">Choose a scenario below to share your perspective</p>
                    </div>

                    <div class="grid gap-6 md:grid-cols-2">
                        ${dilemmas.map(dilemma => `
                            <div onclick="selectDilemma(${dilemma.id})" 
                                 class="bg-white rounded-xl shadow-lg p-6 cursor-pointer transform transition-all hover:scale-105 hover:shadow-xl border-2 border-transparent hover:border-indigo-300">
                                <div class="flex items-start gap-4">
                                    <span class="text-4xl">${dilemma.emoji}</span>
                                    <div class="flex-1">
                                        <h3 class="text-lg font-semibold text-gray-800 mb-2">Scenario ${dilemma.id}</h3>
                                        <p class="text-gray-600 text-sm leading-relaxed">${dilemma.title}</p>
                                        ${votedDilemmas.has(dilemma.id) ? 
                                            '<span class="inline-block mt-3 text-xs bg-green-100 text-green-700 px-3 py-1 rounded-full">‚úì Voted</span>' 
                                            : ''}
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function renderPollPage() {
            const dilemma = dilemmas.find(d => d.id === selectedDilemma);
            return `
                <div class="max-w-3xl mx-auto p-6">
                    <button onclick="backToHome()" class="flex items-center gap-2 text-indigo-600 hover:text-indigo-800 mb-6 transition-colors">
                        ‚Üê Back to scenarios
                    </button>

                    <div class="bg-white rounded-2xl shadow-xl p-8">
                        <div class="text-center mb-8">
                            <span class="text-6xl mb-4 block">${dilemma.emoji}</span>
                            <h2 class="text-2xl font-bold text-gray-800 mb-4">Scenario ${dilemma.id}</h2>
                            <p class="text-gray-600 mb-6 italic">${dilemma.title}</p>
                        </div>

                        <div class="bg-indigo-50 rounded-xl p-6 mb-8">
                            <h3 class="text-xl font-semibold text-indigo-900 mb-4 text-center">${dilemma.question}</h3>
                        </div>

                        <div class="flex gap-4 justify-center">
                            <button onclick="vote('yes')" class="flex-1 max-w-xs bg-green-500 hover:bg-green-600 text-white font-bold py-4 px-8 rounded-xl text-lg transition-colors shadow-lg hover:shadow-xl">
                                üëç Yes
                            </button>
                            <button onclick="vote('no')" class="flex-1 max-w-xs bg-red-500 hover:bg-red-600 text-white font-bold py-4 px-8 rounded-xl text-lg transition-colors shadow-lg hover:shadow-xl">
                                üëé No
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderResultsPage() {
            const dilemma = dilemmas.find(d => d.id === selectedDilemma);
            const totalVotes = votes[selectedDilemma].yes + votes[selectedDilemma].no;
            const yesPercent = totalVotes > 0 ? Math.round((votes[selectedDilemma].yes / totalVotes) * 100) : 0;
            const noPercent = totalVotes > 0 ? Math.round((votes[selectedDilemma].no / totalVotes) * 100) : 0;

            return `
                <div class="max-w-3xl mx-auto p-6">
                    <div class="bg-white rounded-2xl shadow-xl p-8">
                        <div class="text-center mb-8">
                            <span class="text-6xl mb-4 block">${dilemma.emoji}</span>
                            <h2 class="text-2xl font-bold text-gray-800 mb-2">Thank you for voting!</h2>
                            <p class="text-gray-600">You voted: <span class="font-bold text-indigo-600">${userVote.toUpperCase()}</span></p>
                        </div>

                        <div class="mb-8">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold text-gray-800">üìä Live Results</h3>
                                <span class="text-sm text-gray-500">${totalVotes} ${totalVotes === 1 ? 'vote' : 'votes'} total</span>
                            </div>

                            <div class="space-y-4">
                                <div>
                                    <div class="flex justify-between mb-2">
                                        <span class="font-semibold text-green-700">Yes</span>
                                        <span class="font-bold text-green-700">${yesPercent}%</span>
                                    </div>
                                    <div class="bg-gray-200 rounded-full h-6 overflow-hidden">
                                        <div class="bg-green-500 h-full rounded-full transition-all duration-500 flex items-center justify-end pr-2" style="width: ${yesPercent}%">
                                            ${yesPercent > 0 ? `<span class="text-white text-xs font-bold">${votes[selectedDilemma].yes}</span>` : ''}
                                        </div>
                                    </div>
                                </div>

                                <div>
                                    <div class="flex justify-between mb-2">
                                        <span class="font-semibold text-red-700">No</span>
                                        <span class="font-bold text-red-700">${noPercent}%</span>
                                    </div>
                                    <div class="bg-gray-200 rounded-full h-6 overflow-hidden">
                                        <div class="bg-red-500 h-full rounded-full transition-all duration-500 flex items-center justify-end pr-2" style="width: ${noPercent}%">
                                            ${noPercent > 0 ? `<span class="text-white text-xs font-bold">${votes[selectedDilemma].no}</span>` : ''}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="bg-amber-50 border-l-4 border-amber-400 p-6 mb-6 rounded-lg">
                            <h4 class="font-semibold text-amber-900 mb-2">üí° Reflection & Guideline</h4>
                            <p class="text-amber-800 text-sm leading-relaxed">${dilemma.guideline}</p>
                        </div>

                        <div class="mb-6">
                            <label class="text-gray-700 font-semibold mb-2 flex items-center gap-2">
                                üí¨ Share your thoughts (optional)
                            </label>
                            <textarea id="commentBox" 
                                      placeholder="What's your perspective on this dilemma? Share your thoughts here..."
                                      class="w-full border-2 border-gray-300 rounded-lg p-4 focus:border-indigo-500 focus:outline-none resize-none"
                                      rows="4"
                                      ${submitSuccess ? 'disabled' : ''}
                                      oninput="comment = this.value"></textarea>
                            
                            ${!submitSuccess ? `
                                <button onclick="submitComment()" 
                                        id="submitBtn"
                                        ${isSubmitting ? 'disabled' : ''}
                                        class="mt-3 flex items-center justify-center gap-2 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed w-full sm:w-auto">
                                    ${isSubmitting ? 
                                        '<div class="animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full"></div> <span>Submitting...</span>' 
                                        : 'üì§ Submit Comment'}
                                </button>
                            ` : `
                                <div class="mt-3 bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg flex items-center gap-2">
                                    <span class="text-xl">‚úì</span>
                                    <span class="font-semibold">Comment submitted successfully!</span>
                                </div>
                            `}
                        </div>

                        <button onclick="backToHome()" 
                                class="w-full bg-gray-600 hover:bg-gray-700 text-white font-bold py-4 px-6 rounded-xl transition-colors shadow-lg hover:shadow-xl">
                            ‚Üê Back to Homepage
                        </button>
                    </div>
                </div>
            `;
        }

        function selectDilemma(id) {
            selectedDilemma = id;
            userVote = null;
            comment = '';
            submitSuccess = false;
            currentPage = 'poll';
            render();
        }

        function vote(voteChoice) {
            votes[selectedDilemma][voteChoice]++;
            userVote = voteChoice;
            votedDilemmas.add(selectedDilemma);
            currentPage = 'results';
            render();
        }

        function backToHome() {
            currentPage = 'home';
            selectedDilemma = null;
            userVote = null;
            comment = '';
            submitSuccess = false;
            render();
        }

        async function submitComment() {
            const commentText = comment.trim();

            if (!commentText) {
                alert('Please enter a comment before submitting.');
                return;
            }

            isSubmitting = true;
            render();

            const dilemma = dilemmas.find(d => d.id === selectedDilemma);
            
            // Airtable API endpoint
            const airtableUrl = `https://api.airtable.com/v0/${AIRTABLE_BASE_ID}/${encodeURIComponent(AIRTABLE_TABLE_NAME)}`;

            try {
                const response = await fetch(airtableUrl, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${AIRTABLE_TOKEN}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        records: [
                            {
                                fields: {
                                    "Scenario": `Scenario ${selectedDilemma}: ${dilemma.title}`,
                                    "Vote": userVote.toUpperCase(),
                                    "Comment": commentText,
                                    "Timestamp": new Date().toISOString()
                                }
                            }
                        ]
                    })
                });

                if (response.ok) {
                    isSubmitting = false;
                    submitSuccess = true;
                    comment = '';
                    render();
                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || 'Submission failed');
                }
            } catch (error) {
                isSubmitting = false;
                render();
                alert('Failed to submit comment. Please check your Airtable configuration and try again.');
                console.error('Error:', error);
            }
        }

        // Initialize the app
        render();
    </script>
</body>
</html>
